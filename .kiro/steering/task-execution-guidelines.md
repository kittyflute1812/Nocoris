---
inclusion: always
---

# タスク実行ガイドライン

Nocorisプロジェクトにおけるタスク実行の標準的なルールとワークフローです。

## タスク実行の基本原則

### 0. Dartコーディング規約（最優先事項）

**🚨 絶対遵守**: 以下の規約違反は一切受け入れられません

#### 実装時の必須確認事項
```bash
# 実装後の必須チェック（この順序で実行）
1. flutter analyze          # 警告ゼロを確認
2. getDiagnostics           # 診断結果をチェック  
3. flutter test             # 全テスト通過を確認
4. flutter run              # 実際の動作確認
```

#### 禁止コードパターン
```dart
// ❌ 絶対禁止
print('Debug message');                    // loggerを使用
var items = [];                           // 型注釈必須
child: Text('Hello')                      // constコンストラクタ使用
import 'unused_package.dart';             // 未使用import禁止
```

#### 必須コードパターン
```dart
// ✅ 必須パターン
logger.d('Debug message');                // logger使用
final List<Item> items = <Item>[];        // 明示的型注釈
child: const Text('Hello')                // constコンストラクタ
// 使用するimportのみ記述
```

### 1. 段階的実装
- **チェックポイント制:** 大きな機能は段階的に実装し、各段階で動作確認
- **テスト先行:** 実装前にテストケースを明確化
- **漸進的改善:** 最小限の動作する実装から始めて段階的に改善

### 2. 品質保証（Dartコーディング規約準拠）
- **コード品質最優先:** Dart公式lintルール完全準拠
- **警告ゼロ必須:** `flutter analyze` で警告が出るコードは受け入れ不可
- **テスト必須:** すべての実装にはテストを含める
- **診断チェック:** 実装後は必ず`getDiagnostics`でエラーチェック
- **動作確認:** 実装後は実際にアプリを起動して動作確認
- **Logger使用:** `print()` 禁止、`logger` パッケージ必須使用

### 3. コミット戦略
- **機能単位:** 1つのタスクまたは関連するサブタスクごとにコミット
- **Conventional Commits:** `feat:`, `fix:`, `test:`, `refactor:` などのプレフィックス使用
- **日本語OK:** コミットメッセージは日本語で自然な表現を使用
- **自動PR作成:** タスク完了時に自動的にプルリクエストを作成し、レビュー準備を整える

## タスク実行ワークフロー

### Phase 1: 準備
1. **要件確認:** タスクの要件と期待される成果物を明確化
2. **設計確認:** 既存のアーキテクチャとの整合性を確認
3. **テスト計画:** 実装するテストケースを事前に計画

### Phase 2: 実装（コード品質最優先）
1. **テスト作成:** 実装前にテストケースを作成（TDD推奨）
2. **最小実装:** 最小限の動作する実装を作成
3. **🚨 コード品質チェック（必須）:**
   - `flutter analyze` で警告ゼロを確認
   - `getDiagnostics` でコンパイルエラーや警告をチェック
   - Dartコーディング規約完全準拠を確認
4. **テスト実行:** `flutter test`でテストが通ることを確認

### Phase 3: 検証（品質基準クリア必須）
1. **動作確認:** `flutter run`で実際の動作を確認
2. **🚨 最終品質チェック（必須）:**
   - `flutter analyze` で警告ゼロを再確認
   - `getDiagnostics` で問題なしを確認
   - 全てのlintルールをクリア
   - Logger使用確認（print禁止）
3. **パフォーマンス:** 必要に応じてパフォーマンステスト

### Phase 4: 完了
1. **コミット:** Conventional Commits形式でコミット（必須）
2. **PR作成:** タスク完了時に自動的にプルリクエストを作成
3. **ドキュメント更新:** 必要に応じてREADMEやコメントを更新
4. **次タスク準備:** 依存関係のあるタスクの準備

## エラーハンドリング

### コンパイルエラー
- `getDiagnostics`で詳細を確認
- エラーメッセージに基づいて修正
- 修正後は再度診断実行

### テスト失敗
- 失敗したテストの詳細を確認
- 実装とテストの両方を見直し
- 必要に応じてテストケースを調整

### 実行時エラー
- Flutter DevToolsでデバッグ
- ログ出力で問題箇所を特定
- エラーハンドリングの追加

## プロパティテストの扱い

### 実行タイミング
- 基本実装完了後に実行
- MVPでは省略可能（`*`マーク付きタスク）
- 本格運用前には必須

### 失敗時の対応
1. プロパティの前提条件を確認
2. 実装のロジックを見直し
3. 必要に応じてプロパティ定義を調整

## チェックポイントでの確認事項

### コアロジック検証時
- [ ] すべての単体テストが通過
- [ ] 基本的なCRUD操作が動作
- [ ] データの整合性が保たれている
- [ ] **🚨 flutter analyze で警告ゼロ**
- [ ] **🚨 getDiagnostics で問題なし**
- [ ] **🚨 Logger使用確認（print禁止）**

### 統合検証時
- [ ] UI操作が正常に動作
- [ ] データの永続化が機能
- [ ] エラーハンドリングが適切
- [ ] **🚨 全てのlintルールをクリア**
- [ ] **🚨 型安全性を確保**

### 最終検証時
- [ ] 全機能が要件を満たしている
- [ ] パフォーマンスが許容範囲
- [ ] ユーザビリティが良好
- [ ] **🚨 Dartコーディング規約完全準拠**
- [ ] **🚨 警告・エラーゼロを確認**

## 効率化のコツ

### 開発速度向上
- **ホットリロード活用:** UI変更は`r`キーでホットリロード
- **テスト並行実行:** `flutter test --concurrency=4`で高速化
- **部分テスト:** 特定ファイルのみテスト実行

### 品質維持（コード品質最優先）
- **🚨 継続的品質チェック:** 実装中も定期的に`flutter analyze`と`getDiagnostics`実行
- **小さなコミット:** 問題発生時の切り戻しを容易にする
- **Dartコーディング規約遵守:** 全てのコードが規約に準拠
- **Logger使用徹底:** `print()` は一切使用しない
- **ペアプログラミング:** 複雑な実装時はKiroと対話しながら進める

このガイドラインに従って、効率的で高品質なタスク実行を行いましょう。

## 自動コミット・PR作成ルール

### タスク完了時の必須アクション

1. **コミット作成**
   ```bash
   git add [変更されたファイル]
   git commit -m "[type]: [タスク名]（[タスク番号]）を実装

   - [実装内容の詳細]
   - [検証対象の要件]
   - [テスト結果やその他の重要な情報]"
   ```

2. **ブランチ作成・切り替え**
   ```bash
   git checkout -b feature/task-[タスク番号]-[簡潔な説明]
   # 例: git checkout -b feature/task-12.4-ui-integration-property-tests
   ```

3. **プルリクエスト作成**
   ```bash
   gh pr create --title "[type]: [タスク名]（[タスク番号]）" \
                --body "## 概要
   [タスクの概要]

   ## 実装内容
   - [実装した機能]
   - [変更したファイル]

   ## テスト結果
   - [テスト実行結果]

   ## 確認事項
   - [ ] すべてのテストが通過
   - [ ] 診断エラーなし
   - [ ] 要件を満たしている"
   ```

### コミットメッセージの形式

**基本形式:**
```
[type]: [タスク名]（[タスク番号]）を[動詞]

[詳細説明]
- [変更点1]
- [変更点2]
- [テスト結果]
```

**例:**
```
test: UI統合プロパティテスト（12.4）を実装

Property 5, 8, 9の実装完了
- アイテム表示の完全性テスト
- 編集フォーム情報の一致テスト  
- アイテム更新の反映テスト
- 各プロパティ100回反復でテスト実行
```

### 自動化の実装

エージェントは以下の手順でタスク完了を処理する：

1. **taskStatus**ツールで`completed`に更新
2. **git add**で変更ファイルを追加
3. **git commit**でConventional Commits形式でコミット
4. **git checkout -b**で機能ブランチ作成
5. **gh pr create**でプルリクエスト作成
6. ユーザーに完了報告とPR URLを提供

このルールにより、各タスクが独立したPRとして管理され、レビューとマージが効率化される。
