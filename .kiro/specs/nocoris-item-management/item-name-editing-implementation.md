# アイテム名編集機能実装タスク

## 概要

要件4.2で定義されているアイテム名編集機能を実装します。現在の実装では編集モード時にアイテム名フィールドが無効化されており、ItemService.updateItemメソッドも名前の更新をサポートしていません。この不整合を解決し、ユーザーがアイテム名を編集できるようにします。

## 実装タスク

### Phase 1: ItemServiceの拡張

- [ ] 1.1 ItemService.updateItemメソッドの拡張
  - オプショナルな`name`パラメータを追加
  - 後方互換性を保持（既存の呼び出しは影響なし）
  - 名前が提供された場合のみ更新処理を実行
  - _要件: 4.2_

- [ ] 1.2 ItemServiceテストの更新
  - 名前更新機能のテストケースを追加
  - 後方互換性のテストを追加
  - エッジケースのテスト（空文字、null、長すぎる名前など）
  - _要件: 4.2, 4.4_

### Phase 2: UIの修正

- [ ] 2.1 ItemFormScreenの修正
  - 編集モード時の名前フィールドを有効化
  - 名前変更時の適切なバリデーション
  - ユーザビリティの向上（変更内容の明確化）
  - _要件: 4.2, 4.4_

- [ ] 2.2 ItemFormScreenテストの更新
  - 編集モードでの名前変更テストを追加
  - バリデーションテストの更新
  - ウィジェットテストの修正
  - _要件: 4.2, 4.4_

### Phase 3: 統合テスト

- [ ] 3.1 エンドツーエンドテスト
  - アイテム作成→名前編集→保存のフロー確認
  - データ永続化の確認
  - エラーハンドリングの確認
  - _要件: 4.2, 6.1, 6.2_

- [ ] 3.2 プロパティテストの更新
  - **プロパティ 8: 編集フォーム情報の一致** の更新
  - **プロパティ 9: アイテム更新の反映** の更新
  - 名前編集に関する新しいプロパティテストの追加
  - _要件: 4.2_

## 実装詳細

### ItemService.updateItemメソッドの新しいシグネチャ

```dart
Future<bool> updateItem(String id, int count, {String? icon, String? name}) async
```

### 実装のポイント

1. **後方互換性**: 既存の呼び出し`updateItem(id, count, icon: icon)`は変更不要
2. **バリデーション**: 名前が提供された場合は適切なバリデーションを実行
3. **エラーハンドリング**: 無効な名前の場合は適切なエラーメッセージを表示
4. **ユーザビリティ**: 編集画面で名前変更が可能であることを明確に示す

### テスト戦略

1. **単体テスト**: ItemServiceの名前更新機能
2. **ウィジェットテスト**: ItemFormScreenの名前編集UI
3. **統合テスト**: 全体のワークフロー確認
4. **プロパティテスト**: 名前編集の正確性検証

## 完了条件

- [ ] すべてのテストが通過
- [ ] 既存機能に影響がないことを確認
- [ ] 名前編集機能が要件4.2を満たすことを確認
- [ ] ユーザビリティが向上していることを確認
- [ ] データ永続化が正しく動作することを確認

## 注意事項

- 既存のアイテムデータとの互換性を保持
- パフォーマンスへの影響を最小限に抑制
- セキュリティ（入力検証）を適切に実装
- アクセシビリティを考慮したUI実装
