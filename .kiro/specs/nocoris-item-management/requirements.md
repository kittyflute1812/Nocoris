# 要件定義書

## はじめに

Nocoris（ノコリス）は、日用品やアイテムの残数を簡単に管理するためのFlutterアプリケーションです。ユーザーが日常的に使用するアイテムの数量を直感的に追跡し、在庫管理を効率化することを目的としています。

### 実装状況（2025年1月現在）

**✅ 完了済み機能（v1.0.0 - v1.1.1）**:
- 基本アイテム管理（CRUD操作）
- カウント機能（インクリメント・デクリメント）
- 絵文字アイコン機能
- アイテム名編集機能
- Riverpod状態管理
- データ永続化（shared_preferences）
- 包括的テスト（49テスト、すべてパス）

**🚧 開発予定機能**:
- デザインリニューアル（温かみのあるカラーテーマ）
- iOSウィジェット（WidgetKit）
- 型安全ナビゲーション（go_router）
- カテゴリ・ソート・検索機能
- 通知・履歴機能
- 国際化対応

## 用語集

- **System**: Nocorisアプリケーション全体
- **Item**: 管理対象となるアイテム（名前、数量、絵文字アイコン、作成日時、更新日時を持つ）
- **User**: アプリケーションを使用するエンドユーザー
- **Storage_Service**: ローカルストレージへのデータ永続化を担当するサービス
- **Item_Service**: アイテムのビジネスロジックを管理するサービス（ChangeNotifier）
- **Count**: アイテムの現在の数量
- **Icon**: アイテムに設定される絵文字アイコン（emoji_picker_flutter使用）
- **Provider**: Riverpodによる状態管理プロバイダー
- **Widget**: iOSホーム画面・ロック画面に配置されるネイティブウィジェット（将来実装）
- **Category**: アイテムを分類するためのカテゴリ（将来実装）

## 要件

### 要件 1: アイテム作成機能 ✅ **実装済み**

**ユーザーストーリー:** ユーザーとして、新しいアイテムを作成したい。そうすることで、管理したいアイテムをシステムに登録できる。

#### 受け入れ基準

1. ✅ WHEN ユーザーがアイテム作成画面でアイテム名を入力し保存ボタンを押す THEN THE System SHALL 新しいアイテムを作成しアイテム一覧に追加する
2. ✅ WHEN ユーザーがアイテム作成時に絵文字アイコンを選択する THEN THE System SHALL そのアイコンをアイテムに関連付ける
3. ✅ WHEN ユーザーがアイテム名を空で保存しようとする THEN THE System SHALL エラーメッセージを表示し作成を防ぐ
4. ✅ WHEN ユーザーがアイテム作成時に初期数量を入力する THEN THE System SHALL その数量をアイテムの初期値として設定する
5. ✅ WHEN ユーザーがアイテム作成時に数量を入力しない THEN THE System SHALL デフォルト値として0を設定する
6. ✅ WHEN アイテムが作成される THEN THE Storage_Service SHALL アイテムデータをローカルストレージに永続化する

### 要件 2: アイテム表示機能 ✅ **実装済み**

**ユーザーストーリー:** ユーザーとして、登録したアイテムの一覧を確認したい。そうすることで、現在管理しているアイテムとその数量を把握できる。

#### 受け入れ基準

1. ✅ WHEN ユーザーがアプリを起動する THEN THE System SHALL 保存されているすべてのアイテムを一覧表示する
2. ✅ WHEN アイテムが表示される THEN THE System SHALL アイテム名、現在の数量、設定された絵文字アイコンを表示する
3. ✅ WHEN アイテムが存在しない THEN THE System SHALL 適切な空状態メッセージを表示する
4. ✅ WHEN アプリが起動される THEN THE Storage_Service SHALL ローカルストレージからアイテムデータを読み込む

### 要件 3: 数量管理機能 ✅ **実装済み**

**ユーザーストーリー:** ユーザーとして、アイテムの数量を増減させたい。そうすることで、使用や補充に応じて正確な残数を管理できる。

#### 受け入れ基準

1. ✅ WHEN ユーザーがアイテムの「+」ボタンを押す THEN THE System SHALL そのアイテムの数量を1増加させる
2. ✅ WHEN ユーザーがアイテムの「-」ボタンを押す THEN THE System SHALL そのアイテムの数量を1減少させる
3. ✅ WHEN アイテムの数量が0の状態で「-」ボタンを押す THEN THE System SHALL 数量を負の値にしない
4. ✅ WHEN アイテムの数量が変更される THEN THE System SHALL 変更を即座にUIに反映する（Riverpod状態管理）
5. ✅ WHEN アイテムの数量が変更される THEN THE Storage_Service SHALL 変更をローカルストレージに永続化する

### 要件 4: アイテム編集機能 ✅ **実装済み**

**ユーザーストーリー:** ユーザーとして、既存のアイテムの情報を編集したい。そうすることで、アイテム名やアイコンを後から変更できる。

#### 受け入れ基準

1. ✅ WHEN ユーザーがアイテムをタップして編集画面を開く THEN THE System SHALL 現在のアイテム情報を編集フォームに表示する
2. ✅ WHEN ユーザーがアイテム名を変更し保存する THEN THE System SHALL 変更されたアイテム名を保存し一覧に反映する
3. ✅ WHEN ユーザーがアイテムの絵文字アイコンを変更し保存する THEN THE System SHALL 変更されたアイコンを保存し一覧に反映する
4. ✅ WHEN ユーザーがアイテム名を空にして保存しようとする THEN THE System SHALL エラーメッセージを表示し保存を防ぐ
5. ✅ WHEN アイテムが編集される THEN THE Storage_Service SHALL 変更をローカルストレージに永続化する

### 要件 5: アイテム削除機能 ✅ **実装済み**

**ユーザーストーリー:** ユーザーとして、不要になったアイテムを削除したい。そうすることで、管理するアイテムリストを整理できる。

#### 受け入れ基準

1. ✅ WHEN ユーザーがアイテムの削除操作を実行する THEN THE System SHALL 削除確認ダイアログを表示する
2. ✅ WHEN ユーザーが削除を確認する THEN THE System SHALL アイテムを一覧から削除する
3. ✅ WHEN ユーザーが削除をキャンセルする THEN THE System SHALL アイテムを削除せず現在の状態を維持する
4. ✅ WHEN アイテムが削除される THEN THE Storage_Service SHALL ローカルストレージからアイテムデータを削除する

### 要件 6: データ永続化機能 ✅ **実装済み**

**ユーザーストーリー:** ユーザーとして、アプリを再起動してもデータが保持されていてほしい。そうすることで、継続的にアイテム管理ができる。

#### 受け入れ基準

1. ✅ WHEN アイテムデータが変更される THEN THE Storage_Service SHALL 変更を即座にローカルストレージに保存する
2. ✅ WHEN アプリが起動される THEN THE Storage_Service SHALL ローカルストレージからすべてのアイテムデータを読み込む
3. ✅ WHEN ストレージの読み書きでエラーが発生する THEN THE System SHALL 適切なエラーハンドリングを行いユーザーに通知する
4. ✅ THE Storage_Service SHALL shared_preferencesを使用してデータを永続化する

### 要件 7: ユーザーインターフェース機能 ✅ **実装済み**

**ユーザーストーリー:** ユーザーとして、直感的で使いやすいインターフェースを使いたい。そうすることで、効率的にアイテム管理ができる。

#### 受け入れ基準

1. ✅ THE System SHALL システムのダークモード設定に応じて自動的にテーマを切り替える
2. ✅ WHEN ユーザーがボタンを押す THEN THE System SHALL 適切な視覚的フィードバックを提供する
3. ✅ WHEN 非同期処理が実行される THEN THE System SHALL ローディング状態を適切に表示する
4. ✅ WHEN エラーが発生する THEN THE System SHALL ユーザーに分かりやすいエラーメッセージを表示する
5. ✅ THE System SHALL iOS/macOSプラットフォームで一貫したユーザーエクスペリエンスを提供する。具体的には、Cupertinoウィジェットを適切に利用し、各プラットフォームの標準的なUI/UXガイドライン（Human Interface Guidelines）に準拠したネイティブアプリのような体験を実現する

### 要件 8: 絵文字アイコン選択機能 ✅ **実装済み**

**ユーザーストーリー:** ユーザーとして、アイテムに視覚的に分かりやすいアイコンを設定したい。そうすることで、アイテムを素早く識別できる。

#### 受け入れ基準

1. ✅ WHEN ユーザーがアイコン選択ボタンを押す THEN THE System SHALL 絵文字ピッカーを表示する
2. ✅ WHEN ユーザーが絵文字を選択する THEN THE System SHALL 選択された絵文字をアイテムのアイコンとして設定する
3. ✅ WHEN アイコンが設定されていない THEN THE System SHALL デフォルトアイコンを表示する
4. ✅ THE System SHALL emoji_picker_flutterライブラリを使用して絵文字選択機能を提供する

## 将来の機能要件

### 要件 9: デザインリニューアル機能 🎨 **開発中（v1.1.0）**

**ユーザーストーリー:** ユーザーとして、温かみのあるデザインでアプリを使いたい。そうすることで、より親しみやすく楽しい体験ができる。

#### 受け入れ基準

1. 🚧 THE System SHALL リスをイメージした温かみのあるカラーパレットを使用する
   - プライマリ: #8B6F47 (茶色)
   - セカンダリ: #F5E6D3 (ベージュ)
   - アクセント: #E8A87C (ライトオレンジ)
   - エラー: #E89B9B (ピーチ/サーモンピンク)
2. 🚧 WHEN ユーザーがボタンやカードを操作する THEN THE System SHALL 適切なアニメーション効果を提供する
3. 🚧 WHEN アイテムが存在しない THEN THE System SHALL リスのマスコットキャラクターと共に空状態を表示する
4. 🚧 THE System SHALL マイクロインタラクション（タップフィードバック、ホバー効果）を提供する

### 要件 10: iOSウィジェット機能 📱 **計画中（v1.3.0）**

**ユーザーストーリー:** ユーザーとして、ホーム画面やロック画面からアイテムの残数を確認・操作したい。そうすることで、アプリを開かずに素早く管理できる。

#### 受け入れ基準

1. 🚧 THE System SHALL iOSホーム画面にウィジェットを配置できる機能を提供する
2. 🚧 THE System SHALL ウィジェットで選択したアイテムの名前と数量を表示する
3. 🚧 WHEN ユーザーがウィジェットの「-」ボタンを押す THEN THE System SHALL アイテムの数量を1減少させる
4. 🚧 THE System SHALL 小・中・大サイズのウィジェットレイアウトを提供する
5. 🚧 THE System SHALL ロック画面ウィジェット（iOS 16+）に対応する
6. 🚧 THE System SHALL App Groupsを使用してメインアプリとウィジェット間でデータを共有する
7. 🚧 THE System SHALL Timeline Providerを使用してウィジェットの更新を管理する

### 要件 11: 型安全ナビゲーション機能 🏗️ **計画中（v1.2.0）**

**ユーザーストーリー:** 開発者として、型安全で保守しやすいナビゲーションを使いたい。そうすることで、バグを減らし開発効率を向上させる。

#### 受け入れ基準

1. 🚧 THE System SHALL go_routerライブラリを使用した型安全なナビゲーションを提供する
2. 🚧 THE System SHALL ルート定義を一箇所に集約する
3. 🚧 THE System SHALL ディープリンク対応を提供する
4. 🚧 THE System SHALL ナビゲーションガード機能を提供する

### 要件 12: カテゴリ機能 📂 **計画中（v1.4.0）**

**ユーザーストーリー:** ユーザーとして、アイテムをカテゴリ別に分類したい。そうすることで、大量のアイテムを効率的に管理できる。

#### 受け入れ基準

1. 🚧 WHEN ユーザーがカテゴリを作成する THEN THE System SHALL 新しいカテゴリを作成し保存する
2. 🚧 WHEN ユーザーがアイテムにカテゴリを設定する THEN THE System SHALL アイテムとカテゴリを関連付ける
3. 🚧 WHEN ユーザーがカテゴリフィルターを選択する THEN THE System SHALL 該当カテゴリのアイテムのみを表示する
4. 🚧 THE System SHALL カテゴリごとに色分け表示を提供する

### 要件 13: ソート・検索機能 🔍 **計画中（v1.4.0）**

**ユーザーストーリー:** ユーザーとして、アイテムを並び替えたり検索したりしたい。そうすることで、目的のアイテムを素早く見つけられる。

#### 受け入れ基準

1. 🚧 WHEN ユーザーがソート条件を選択する THEN THE System SHALL アイテムを指定された順序で表示する
   - 名前順（昇順・降順）
   - 作成日時順（新しい順・古い順）
   - 更新日時順（新しい順・古い順）
   - カウント数順（多い順・少ない順）
2. 🚧 WHEN ユーザーが検索ボックスに文字を入力する THEN THE System SHALL 名前に該当文字を含むアイテムを表示する
3. 🚧 THE System SHALL インクリメンタルサーチ（入力中のリアルタイム検索）を提供する
4. 🚧 THE System SHALL ソート設定を永続化する

### 要件 14: 通知機能 🔔 **計画中（v2.0.0）**

**ユーザーストーリー:** ユーザーとして、アイテムの残数が少なくなったら通知を受け取りたい。そうすることで、補充のタイミングを逃さない。

#### 受け入れ基準

1. 🚧 WHEN ユーザーがアイテムに通知閾値を設定する THEN THE System SHALL 閾値情報を保存する
2. 🚧 WHEN アイテムの数量が設定された閾値以下になる THEN THE System SHALL ローカル通知を送信する
3. 🚧 WHEN ユーザーが通知設定画面を開く THEN THE System SHALL 各アイテムの通知設定を表示・編集できる
4. 🚧 THE System SHALL 通知の有効/無効を個別に設定できる機能を提供する

### 要件 15: 履歴機能 📊 **計画中（v2.0.0）**

**ユーザーストーリー:** ユーザーとして、アイテムの使用履歴や統計情報を確認したい。そうすることで、使用パターンを把握し効率的な管理ができる。

#### 受け入れ基準

1. 🚧 WHEN アイテムの数量が変更される THEN THE System SHALL 変更履歴を記録する
2. 🚧 WHEN ユーザーが履歴画面を開く THEN THE System SHALL アイテムごとの変更履歴を表示する
3. 🚧 WHEN ユーザーが統計画面を開く THEN THE System SHALL 使用パターンをグラフで表示する
4. 🚧 THE System SHALL 日別・週別・月別の統計情報を提供する

### 要件 16: データ管理機能 💾 **計画中（v2.0.0）**

**ユーザーストーリー:** ユーザーとして、データのバックアップや他デバイスとの同期をしたい。そうすることで、データの安全性と利便性を確保できる。

#### 受け入れ基準

1. 🚧 WHEN ユーザーがエクスポート機能を使用する THEN THE System SHALL 全データをJSON形式でエクスポートする
2. 🚧 WHEN ユーザーがインポート機能を使用する THEN THE System SHALL JSON形式のデータをインポートする
3. 🚧 THE System SHALL iCloud同期機能を提供する（検討中）
4. 🚧 THE System SHALL データの整合性チェック機能を提供する

### 要件 17: 国際化対応機能 🌍 **計画中（v2.1.0）**

**ユーザーストーリー:** ユーザーとして、自分の言語でアプリを使いたい。そうすることで、より理解しやすく使いやすい体験ができる。

#### 受け入れ基準

1. 🚧 THE System SHALL flutter_localizationsを使用した多言語対応を提供する
2. 🚧 THE System SHALL 日本語・英語の言語リソースを提供する
3. 🚧 WHEN ユーザーが言語設定を変更する THEN THE System SHALL 動的に言語を切り替える
4. 🚧 THE System SHALL 日付・数値のローカライゼーションを提供する
5. 🚧 THE System SHALL 右から左への言語（RTL）に対応する

### 要件 18: アクセシビリティ機能 ♿ **計画中（v2.1.0）**

**ユーザーストーリー:** 視覚や聴覚に障害のあるユーザーとして、アクセシブルなアプリを使いたい。そうすることで、誰でも平等にアプリを利用できる。

#### 受け入れ基準

1. 🚧 THE System SHALL スクリーンリーダー対応を提供する
2. 🚧 THE System SHALL 適切なセマンティックラベルを全ウィジェットに設定する
3. 🚧 THE System SHALL 動的フォントサイズ調整に対応する
4. 🚧 THE System SHALL 適切なコントラスト比を維持する
5. 🚧 THE System SHALL キーボードナビゲーションに対応する

### 要件 19: CI/CD機能 🔄 **計画中（v1.2.0）**

**ユーザーストーリー:** 開発者として、自動化されたビルド・テスト・デプロイ環境を使いたい。そうすることで、開発効率と品質を向上させる。

#### 受け入れ基準

1. 🚧 THE System SHALL GitHub Actionsによる自動テスト実行を提供する
2. 🚧 THE System SHALL 自動リンティング・フォーマットチェックを提供する
3. 🚧 THE System SHALL TestFlightへの自動デプロイを提供する
4. 🚧 THE System SHALL カバレッジレポートの自動生成を提供する
5. 🚧 THE System SHALL 自動バージョン管理を提供する
