# Lefthook configuration for Nocoris project
# https://github.com/evilmartians/lefthook

# Pre-commit hooks - ã‚³ãƒŸãƒƒãƒˆå‰ã®å“è³ªãƒã‚§ãƒƒã‚¯
pre-commit:
  parallel: true
  commands:
    format-check:
      glob: "*.dart"
      run: dart format --set-exit-if-changed {staged_files}
      stage_fixed: true

    analyze:
      run: flutter analyze --no-pub

    version-check:
      run: |
        VERSION_FILE=".flutter-version"
        if [ -f "$VERSION_FILE" ]; then
          REQUIRED_VERSION=$(cat "$VERSION_FILE" | tr -d '[:space:]')
          CURRENT_VERSION=$(flutter --version | head -n 1 | awk '{print $2}')
          if [ "$CURRENT_VERSION" != "$REQUIRED_VERSION" ]; then
            echo "âš ï¸  Flutter version mismatch!"
            echo "   Required: $REQUIRED_VERSION"
            echo "   Current:  $CURRENT_VERSION"
            echo "ğŸ’¡ Run: flutter version $REQUIRED_VERSION"
            exit 1
          fi
        fi

# Pre-push hooks - ãƒ—ãƒƒã‚·ãƒ¥å‰ã®å®Œå…¨ãƒã‚§ãƒƒã‚¯
pre-push:
  commands:
    test:
      run: flutter test

# Commit-msg hooks - ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æ¤œè¨¼
commit-msg:
  commands:
    conventional-commits:
      run: |
        MSG=$(cat {1})
        if ! echo "$MSG" | grep -qE "^(feat|fix|docs|style|refactor|test|chore|perf|ci|build|revert)(\(.+\))?: .+"; then
          echo "âŒ Commit message must follow Conventional Commits format"
          echo "Examples:"
          echo "  feat: æ–°æ©Ÿèƒ½ã‚’è¿½åŠ "
          echo "  fix: ãƒã‚°ã‚’ä¿®æ­£"
          echo "  docs: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ›´æ–°"
          echo "  style: ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’ä¿®æ­£"
          echo "  refactor: ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°"
          echo "  test: ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ "
          echo "  chore: ãƒ“ãƒ«ãƒ‰ãƒ—ãƒ­ã‚»ã‚¹ã‚„ãƒ„ãƒ¼ãƒ«ã®å¤‰æ›´"
          exit 1
        fi

# Skip hooks with environment variable
skip_output:
  - meta
  - success
