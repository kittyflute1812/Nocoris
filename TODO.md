# Nocoris - 開発TODO 🐿️

## 📋 プロジェクト概要

iPhoneユーザー向けの残数管理アプリケーション「Nocoris（ノコリス）」。アイテムの数量を簡単に管理し、ウィジェットからも操作可能。

## 🎯 技術スタック

- **開発言語**: Flutter/Dart
- **ストレージ**: ローカルストレージ（shared_preferences）
- **対象プラットフォーム**: iOS（iPhone）、macOS（開発用）
- **テストフレームワーク**: flutter_test、mocktail

---

## 🚧 今後対応予定の機能

### 1. 状態管理の改善
- [ ] より適切な状態管理ソリューションの導入
  - [ ] Provider/Riverpodの導入検討
  - [ ] 状態管理パターンの選定（BLoC/Provider/Riverpod）
  - [ ] グローバル状態の最小化
  - [ ] 状態とUIコンポーネントの分離強化
  - [ ] 不変データ構造の徹底

**技術要件**:
- Provider/Riverpod パッケージ
- 状態管理アーキテクチャの設計
- 既存コードのリファクタリング

**実装の流れ**:
1. 状態管理ソリューションの選定（Provider推奨）
2. 依存性注入の実装
3. ItemServiceのProvider化
4. 画面ごとの状態管理の実装
5. テストの更新

**優先度**: 中（アプリが複雑になる前に導入推奨）

### 2. デザインアップデート 🎨
- [ ] アイテムアイコン機能の実装
  - [ ] アイテムに画像/アイコンを登録できる機能
  - [ ] アイコン選択UI（絵文字ピッカーまたはアイコンライブラリ）
  - [ ] 画像アップロード機能（オプション）
  - [ ] デフォルトアイコンセットの用意
  - [ ] アイコン表示の最適化

- [ ] カラーテーマの刷新
  - [ ] アプリアイコンのカラーコード（茶色・ベージュ・オレンジ系）を基調としたデザイン
  - [ ] 温かみのあるカラーパレットの定義
  - [ ] アイテムカードのデザイン改善
    - [ ] 背景色のバリエーション（ベージュ、ライトオレンジ、ピーチなど）
    - [ ] 角丸の調整
    - [ ] シャドウ/エレベーションの最適化
  - [ ] ボタンデザインの改善
    - [ ] +/- ボタンを円形の茶色ボタンに
    - [ ] ホバー/タップエフェクトの追加
  - [ ] タイポグラフィの改善
    - [ ] フォントの選定（温かみのある書体）
    - [ ] 数字の大きさとウェイトの調整

- [ ] UIコンポーネントの改善
  - [ ] リスのマスコットキャラクターの配置
  - [ ] 空状態のイラスト追加
  - [ ] アニメーション効果の追加
  - [ ] マイクロインタラクションの実装

**デザイン参考**:
- 添付画像のような温かみのあるデザイン
- カラーパレット例:
  - プライマリ: `#8B6F47` (茶色)
  - セカンダリ: `#F5E6D3` (ベージュ)
  - アクセント: `#E8A87C` (ライトオレンジ)
  - エラー/警告: `#E89B9B` (ピーチ/サーモンピンク)

**技術要件**:
- image_picker パッケージ（画像アップロード用）
- flutter_emoji または emoji_picker_flutter（絵文字選択用）
- カスタムテーマの拡張
- アニメーションライブラリ（flutter_animate など）

**実装の流れ**:
1. カラーパレットの定義と適用
2. ItemモデルにiconフィールドとcolorFieldを追加
3. アイコン選択UIの実装
4. アイテムカードのデザイン刷新
5. ボタンとタイポグラフィの改善
6. アニメーション効果の追加
7. テストの更新

**優先度**: 高（ユーザー体験向上のため）

### 3. ナビゲーションの型安全化
- [ ] 型安全なナビゲーションの実装
  - [ ] go_router または auto_route の導入
  - [ ] ルート定義の集約
  - [ ] ディープリンク対応
  - [ ] ナビゲーションガードの実装

**技術要件**:
- go_router または auto_route パッケージ
- ルート設定ファイル

**優先度**: 中

### 4. iOSホーム画面ウィジェット機能
- [ ] WidgetKit を使用したホーム画面ウィジェットの実装
  - [ ] WidgetKit Extension の作成（Swift）
  - [ ] Timeline Provider の実装
  - [ ] ウィジェットレイアウトの設計（小・中・大サイズ対応）
  - [ ] アイテム選択機能（どのアイテムをウィジェットに表示するか）
  - [ ] ウィジェットでの残数表示
  - [ ] ウィジェットからの減算ボタン（App Intent使用）
  - [ ] App Groups によるデータ共有設定
  - [ ] ウィジェットの更新タイミング制御
  - [ ] ロック画面ウィジェット対応（iOS 16+）

**技術要件**:
- WidgetKit (iOS 14+)
- SwiftUI（ウィジェットUI）
- App Groups（メインアプリとウィジェット間のデータ共有）
- App Intents（ウィジェットからのインタラクション、iOS 16+）
- Timeline Provider（ウィジェットの更新管理）

**実装の流れ**:
1. Xcode でWidget Extension ターゲットを追加
2. App Groups を設定してデータ共有を有効化
3. Flutter側でApp Groups対応のストレージ実装
4. Swift/SwiftUIでウィジェットUIを実装
5. Timeline Providerでデータ更新を管理
6. App Intentsでボタンアクションを実装

**優先度**: 高

### 5. パフォーマンス最適化
- [ ] ウィジェット最適化
  - [ ] constコンストラクタの活用拡大
  - [ ] ValueKeyの適切な使用
  - [ ] RepaintBoundaryの導入検討
  - [ ] 不要な再構築の削減

- [ ] メモリ管理
  - [ ] メモリプロファイリングの実施
  - [ ] メモリリークの確認と修正
  - [ ] グローバル変数の最小化

- [ ] レンダリング最適化
  - [ ] Flutter Performance Overlayでの分析
  - [ ] ウィジェットツリーの簡素化
  - [ ] 画像の最適化（将来的に画像を使用する場合）

- [ ] バンドルサイズ最適化
  - [ ] 未使用コードの削除
  - [ ] コードの難読化設定
  - [ ] ABI分割ビルドの設定

- [ ] 大量データ対応
  - [ ] ListView.builderの最適化確認
  - [ ] ページネーション/無限スクロールの検討
  - [ ] データの遅延読み込み戦略

**優先度**: 中（アイテム数が増えた際に重要）

### 6. テストカバレッジの拡充
- [ ] 統合テストの追加
  - [ ] 画面間の相互作用テスト
  - [ ] データフローの統合テスト
  - [ ] エラーハンドリングの統合テスト

- [ ] エンドツーエンドテスト
  - [ ] ユーザーシナリオのE2Eテスト
  - [ ] クリティカルパスのテスト
  - [ ] パフォーマンステスト

- [ ] テストカバレッジの向上
  - [ ] カバレッジレポートの生成
  - [ ] 未カバー領域の特定と追加テスト
  - [ ] エッジケースのテスト強化

**優先度**: 中

### 7. エラーハンドリングの強化
- [ ] カスタムエラークラスの実装
  - [ ] エラータイプの分類
  - [ ] エラーコードの定義
  - [ ] エラーメッセージの統一

- [ ] ロギング機能の強化
  - [ ] エラーログの記録
  - [ ] デバッグログの実装
  - [ ] ログレベルの管理

- [ ] エラー画面の改善
  - [ ] カスタムErrorWidgetの実装
  - [ ] エラーリカバリー機能
  - [ ] ユーザーフレンドリーなエラー表示

**優先度**: 中

### 8. セキュリティ対策
- [ ] データ保護
  - [ ] 機密データの暗号化（将来的に必要な場合）
  - [ ] Keychain/Keystoreの活用検討
  - [ ] セキュアストレージの実装

- [ ] 入力検証の強化
  - [ ] サニタイゼーション処理の追加
  - [ ] バリデーションルールの強化
  - [ ] XSS対策（Webプラットフォーム対応時）

**優先度**: 低（現状は個人データのみ）

### 9. 国際化対応
- [ ] 多言語対応
  - [ ] flutter_localizationの導入
  - [ ] 言語リソースファイルの作成
  - [ ] 動的言語切り替え機能
  - [ ] 日付・数値のローカライゼーション

- [ ] アクセシビリティ向上
  - [ ] スクリーンリーダー対応の強化
  - [ ] セマンティックラベルの充実
  - [ ] フォントサイズの動的調整
  - [ ] コントラスト比の確認

**優先度**: 低（グローバル展開時に必要）

### 10. CI/CD環境の構築
- [ ] 自動化パイプラインの構築
  - [ ] GitHub Actionsの設定
  - [ ] 自動テスト実行
  - [ ] 自動リンティング/フォーマット
  - [ ] 自動ビルド

- [ ] デプロイ自動化
  - [ ] TestFlightへの自動デプロイ
  - [ ] App Storeへのリリース自動化
  - [ ] バージョン管理の自動化

- [ ] コード品質管理
  - [ ] カバレッジレポートの自動生成
  - [ ] 静的解析の自動実行
  - [ ] コードレビューの自動化支援

**優先度**: 中（開発効率向上のため）

### 11. デバッグ・モニタリング機能
- [ ] 開発ツールの活用
  - [ ] Flutter DevToolsの活用
  - [ ] パフォーマンスプロファイリング
  - [ ] メモリプロファイリング
  - [ ] ネットワークインスペクション（将来的に）

- [ ] クラッシュレポート
  - [ ] Crashlyticsの導入検討
  - [ ] エラートラッキング
  - [ ] ユーザーフィードバック機能

**優先度**: 中（本番リリース前に推奨）

### 12. 追加機能（検討中）

#### カテゴリ機能
- [ ] アイテムのカテゴリ分け機能
  - [ ] カテゴリモデルの作成
  - [ ] カテゴリ別表示
  - [ ] カテゴリフィルター
  - [ ] カテゴリごとの色分け

**優先度**: 中

#### データ管理
- [ ] データのバックアップ/リストア機能
  - [ ] JSON エクスポート
  - [ ] JSON インポート
  - [ ] iCloud 同期（検討中）

**優先度**: 低

#### 通知機能
- [ ] アイテムごとの通知機能
  - [ ] 閾値設定（残数が少なくなった時）
  - [ ] プッシュ通知
  - [ ] 通知設定画面

**優先度**: 低

#### 履歴機能
- [ ] カウント変更履歴
  - [ ] 履歴データモデル
  - [ ] 履歴表示画面
  - [ ] 統計情報（グラフ表示）

**優先度**: 低

#### ソート・検索
- [ ] アイテムのソート機能
  - [ ] 名前順
  - [ ] 作成日時順
  - [ ] 更新日時順
  - [ ] カウント数順

- [ ] アイテムの検索機能
  - [ ] 名前で検索
  - [ ] インクリメンタルサーチ

**優先度**: 中

---

## 🐛 既知の問題

現在、既知の重大な問題はありません。

---

## 📝 開発メモ

### 最近の変更
- 2026-01-04: **Riverpod による状態管理の導入完了** ✅
  - `flutter_riverpod` パッケージの導入
  - `ItemService` を `ChangeNotifier` として実装
  - `itemServiceProvider` と `itemServiceInitProvider` の作成
  - `HomeScreen` と `ItemFormScreen` を `ConsumerWidget` に変更
  - 全テストをRiverpod対応に更新（40テスト全て成功）
  - 依存性注入の実装完了
- 2026-01-04: drop_counter → Nocoris への移行完了
  - パッケージ名、バンドル識別子、テストファイルを全て更新
  - iOS/Android/macOS の設定ファイルを修正
  - 43箇所の修正を完了
- 2026-01-04: .cursorrulesに基づくリファクタリング完了
  - 機能ベースのディレクトリ構造に再構成
  - 共通ウィジェット（ErrorView, LoadingView, EmptyStateView）の作成
  - 定数の集約（AppConstants, AppStrings）
  - 巨大なウィジェットの分解
  - Itemモデルの不変化（copyWithメソッド追加）
- 2026-01-04: CardTheme → CardThemeData に修正（CI エラー解消）
- 2026-01-04: `use_build_context_synchronously` 警告を解消
- 2026-01-04: `updateItem()` の戻り値チェックを実装
- 2026-01-04: 非同期初期化のエラーハンドリングを強化
- 2026-01-04: 不要なプラットフォームディレクトリを削除（web, windows, linux）

### 技術的負債
- ~~状態管理: 現在はsetStateベース。アプリが複雑化する前にProvider/Riverpodの導入を推奨~~ ✅ **完了（Riverpod導入済み）**
- ナビゲーション: MaterialPageRouteを使用。型安全なgo_routerへの移行を検討
- テストカバレッジ: 単体テストとウィジェットテストは充実。統合テストとE2Eテストの追加を推奨

### 次のマイルストーン
1. **v1.0.0**: 基本機能の完成 ✅ **完了**
   - アイテム管理、データ永続化、UI実装、テスト
   - .cursorrulesに基づくリファクタリング完了
   - drop_counter → Nocoris への移行完了

2. **v1.1.0**: デザインリニューアル 🎨 **次のステップ**
   - アイテムアイコン/画像機能の追加
   - 温かみのあるカラーテーマへの刷新
   - UIコンポーネントの改善
   - アニメーション効果の追加

3. **v1.2.0**: アーキテクチャ改善
   - 状態管理の導入（Provider/Riverpod）
   - 型安全なナビゲーション（go_router）
   - CI/CD環境の構築

4. **v1.3.0**: iOSウィジェット機能の追加
   - WidgetKitの導入と実装
   - ホーム画面・ロック画面ウィジェット

5. **v1.4.0**: 機能拡張
   - カテゴリ機能とソート機能
   - パフォーマンス最適化

6. **v2.0.0**: 高度な機能
   - 通知機能と履歴機能
   - 国際化対応

---

## 📚 参考資料

- [Flutter公式ドキュメント](https://flutter.dev/docs)
- [WidgetKit チュートリアル](https://developer.apple.com/documentation/widgetkit)
- [shared_preferences パッケージ](https://pub.dev/packages/shared_preferences)
- [Flutter テストガイド](https://flutter.dev/docs/testing)

---

## 🎯 現在の開発フォーカス

**Phase 1: 基本機能の完成** ✅ 完了
- アイテム管理、データ永続化、UI実装、テスト
- .cursorrulesに基づくリファクタリング
- drop_counter → Nocoris への移行

**Phase 2: デザインリニューアル** 🎨 **次のステップ**
- アイテムアイコン/画像機能の追加
- 温かみのあるカラーテーマへの刷新
- UIコンポーネントとアニメーションの改善

**Phase 3: アーキテクチャ改善** 🎯 推奨
- 状態管理の導入（Provider/Riverpod）
- 型安全なナビゲーション（go_router）
- CI/CD環境の構築

**Phase 4: iOSウィジェット機能** 🚧 主要機能
- WidgetKit の導入と実装

**Phase 5: 機能拡張** 📅 将来的に
- カテゴリ、通知、履歴、検索など
- 国際化対応

## 📊 開発優先度まとめ

### 高優先度（v1.1.0で対応）
1. **デザインアップデート** 🎨
   - アイテムアイコン/画像機能
   - カラーテーマの刷新
   - UIコンポーネントの改善
2. 状態管理の導入（Provider/Riverpod）

### 中優先度（v1.2.0-1.4.0で対応）
1. 型安全なナビゲーション（go_router）
2. CI/CD環境の構築
3. iOSウィジェット機能
4. テストカバレッジの拡充
5. パフォーマンス最適化
6. カテゴリ・ソート機能

### 低優先度（v2.0.0以降で対応）
1. セキュリティ対策の強化
2. 国際化対応
3. 通知機能と履歴機能
4. アクセシビリティの向上
