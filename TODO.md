# CountDrop - 開発TODO

## 📋 プロジェクト概要

iPhoneユーザー向けの残数管理アプリケーション。アイテムの数量を簡単に管理し、ウィジェットからも操作可能。

## 🎯 技術スタック

- **開発言語**: Flutter/Dart
- **ストレージ**: ローカルストレージ（shared_preferences）
- **対象プラットフォーム**: iOS（iPhone）、macOS（開発用）
- **テストフレームワーク**: flutter_test、mocktail

---

## ✅ 完了した機能

### 1. アイテム管理基本機能
- [x] アイテムのCRUD操作の実装
  - [x] アイテム作成機能（名前、初期値の設定）
  - [x] アイテム一覧表示機能
  - [x] アイテム値の更新機能
  - [x] アイテム削除機能
  - [x] アイテムのインクリメント/デクリメント機能

**実装詳細**:
- `Item` モデル: ID、名前、カウント、作成日時、更新日時を管理
- `ItemService`: ビジネスロジックを集約（CRUD、カウント操作）
- UUID v4によるユニークID生成

### 2. データ永続化
- [x] ローカルストレージの実装
  - [x] shared_preferencesの導入
  - [x] アイテムデータの保存処理
  - [x] アイテムデータの読み込み処理
  - [x] JSON シリアライゼーション/デシリアライゼーション

**実装詳細**:
- `StorageService`: shared_preferencesの抽象化層
- すべての変更操作後に自動保存
- エラーハンドリング実装済み

### 3. UI/UX実装
- [x] メイン画面の実装（HomeScreen）
  - [x] アイテム一覧表示UI
  - [x] アイテム追加ボタン（FloatingActionButton）
  - [x] 各アイテムの減算/加算ボタン
  - [x] アイテム編集/削除機能へのアクセス
  - [x] 空状態の表示（アイテムがない場合）
  - [x] ローディング状態の表示
  - [x] エラーハンドリングとユーザーフィードバック（SnackBar）

- [x] アイテム作成/編集画面の実装（ItemFormScreen）
  - [x] アイテム名入力フォーム
  - [x] 数値入力フォーム
  - [x] 保存/キャンセルボタン
  - [x] バリデーション（必須入力チェック、数値検証）
  - [x] エラーハンドリング

- [x] 再利用可能なウィジェット
  - [x] ItemCard: アイテム表示カード

- [x] テーマ実装
  - [x] ライトモード
  - [x] ダークモード
  - [x] システム設定に応じた自動切り替え

**実装詳細**:
- Material Design準拠
- レスポンシブデザイン
- アクセシビリティ対応

### 4. テストとデバッグ
- [x] 単体テストの実装
  - [x] モデルのテスト（item_test.dart）
  - [x] ストレージ処理のテスト（storage_service_test.dart）
  - [x] ビジネスロジックのテスト（item_service_test.dart）

- [x] ウィジェットテスト
  - [x] HomeScreenのテスト（home_screen_test.dart）
  - [x] ItemFormScreenのテスト（item_form_screen_test.dart）
  - [x] ItemCardのテスト（item_card_test.dart）
  - [x] 基本的な操作フローのテスト
  - [x] エッジケースのテスト

- [x] テストヘルパー
  - [x] モックサービスの作成（test_helpers.dart）
  - [x] テストユーティリティ関数

**テスト状況**:
- 総テスト数: 39
- 合格率: 100%
- カバレッジ: 主要機能をカバー

### 5. エラーハンドリング
- [x] 非同期処理のエラーハンドリング
  - [x] ItemService初期化失敗時の処理
  - [x] データ保存失敗時の処理
  - [x] データ読み込み失敗時の処理

- [x] ユーザーフィードバック
  - [x] エラーメッセージの表示（SnackBar）
  - [x] 成功メッセージの表示
  - [x] ローディング状態の表示

- [x] BuildContext の適切な使用
  - [x] `use_build_context_synchronously` 警告の解消
  - [x] `mounted` チェックの実装

---

## 🚧 開発中・予定の機能

### 6. iOSホーム画面ウィジェット機能
- [ ] WidgetKit を使用したホーム画面ウィジェットの実装
  - [ ] WidgetKit Extension の作成（Swift）
  - [ ] Timeline Provider の実装
  - [ ] ウィジェットレイアウトの設計（小・中・大サイズ対応）
  - [ ] アイテム選択機能（どのアイテムをウィジェットに表示するか）
  - [ ] ウィジェットでの残数表示
  - [ ] ウィジェットからの減算ボタン（App Intent使用）
  - [ ] App Groups によるデータ共有設定
  - [ ] ウィジェットの更新タイミング制御
  - [ ] ロック画面ウィジェット対応（iOS 16+）

**技術要件**:
- WidgetKit (iOS 14+)
- SwiftUI（ウィジェットUI）
- App Groups（メインアプリとウィジェット間のデータ共有）
- App Intents（ウィジェットからのインタラクション、iOS 16+）
- Timeline Provider（ウィジェットの更新管理）

**実装の流れ**:
1. Xcode でWidget Extension ターゲットを追加
2. App Groups を設定してデータ共有を有効化
3. Flutter側でApp Groups対応のストレージ実装
4. Swift/SwiftUIでウィジェットUIを実装
5. Timeline Providerでデータ更新を管理
6. App Intentsでボタンアクションを実装

**優先度**: 高

### 7. パフォーマンス最適化
- [ ] アプリケーションの動作確認
  - [ ] メモリ使用量の確認と最適化
  - [ ] 動作の軽快さの確認
  - [ ] 起動時間の最適化
  - [ ] リスト表示のパフォーマンス最適化（大量アイテム対応）

- [ ] ウィジェットの動作確認
  - [ ] メイン画面との同期確認
  - [ ] 更新頻度の最適化
  - [ ] バッテリー消費の最適化

**優先度**: 中

### 8. 追加機能（検討中）

#### カテゴリ機能
- [ ] アイテムのカテゴリ分け機能
  - [ ] カテゴリモデルの作成
  - [ ] カテゴリ別表示
  - [ ] カテゴリフィルター
  - [ ] カテゴリごとの色分け

**優先度**: 中

#### データ管理
- [ ] データのバックアップ/リストア機能
  - [ ] JSON エクスポート
  - [ ] JSON インポート
  - [ ] iCloud 同期（検討中）

**優先度**: 低

#### 通知機能
- [ ] アイテムごとの通知機能
  - [ ] 閾値設定（残数が少なくなった時）
  - [ ] プッシュ通知
  - [ ] 通知設定画面

**優先度**: 低

#### 履歴機能
- [ ] カウント変更履歴
  - [ ] 履歴データモデル
  - [ ] 履歴表示画面
  - [ ] 統計情報（グラフ表示）

**優先度**: 低

#### ソート・検索
- [ ] アイテムのソート機能
  - [ ] 名前順
  - [ ] 作成日時順
  - [ ] 更新日時順
  - [ ] カウント数順

- [ ] アイテムの検索機能
  - [ ] 名前で検索
  - [ ] インクリメンタルサーチ

**優先度**: 中

---

## 🐛 既知の問題

現在、既知の重大な問題はありません。

---

## 📝 開発メモ

### 最近の変更
- 2025-01-04: CardTheme → CardThemeData に修正（CI エラー解消）
- 2025-01-04: `use_build_context_synchronously` 警告を解消
- 2025-01-04: `updateItem()` の戻り値チェックを実装
- 2025-01-04: 非同期初期化のエラーハンドリングを強化
- 2025-01-04: 不要なプラットフォームディレクトリを削除（web, windows, linux）

### 技術的負債
- 特になし（現在のコードベースは健全な状態）

### 次のマイルストーン
1. **v1.0.0**: 基本機能の完成（現在ほぼ完了）
2. **v1.1.0**: iOSウィジェット機能の追加
3. **v1.2.0**: カテゴリ機能とソート機能の追加
4. **v2.0.0**: 通知機能と履歴機能の追加

---

## 📚 参考資料

- [Flutter公式ドキュメント](https://flutter.dev/docs)
- [WidgetKit チュートリアル](https://developer.apple.com/documentation/widgetkit)
- [shared_preferences パッケージ](https://pub.dev/packages/shared_preferences)
- [Flutter テストガイド](https://flutter.dev/docs/testing)

---

## 🎯 現在の開発フォーカス

**Phase 1: 基本機能の完成** ✅ 完了
- アイテム管理、データ永続化、UI実装、テスト

**Phase 2: iOSウィジェット機能** 🚧 次のステップ
- WidgetKit の導入と実装

**Phase 3: 機能拡張** 📅 将来的に
- カテゴリ、通知、履歴、検索など
